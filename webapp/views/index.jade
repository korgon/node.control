extends layout_minimal

block jscripts
	script(src="/javascripts/jquery-waiting.js")
	script(src="/socket.io/socket.io.js")
	script(src="/javascripts/jquery-ui-1.10.3.js")
	script.
		// global variables
		var hostname = '#{hostname}';
		var serverTime;

		// do stuff once document loads
		$(window).load(function() {
			//$(document).ready(function() { 
			// give a red border to all div elements
			//$("div").css({"border-color": "#FF0000", "border-weight":"1px", "border-style":"solid"});

			// all items with a title attribute get tooltips :)
			//$( document ).tooltip({track: false , opacity: 0.5});

			// hide / show stuff on hover

			$('.buttonContainer').mouseenter(showLinks);
			$('.buttonContainer').mouseleave(hideLinks);
			
			$('.linkIcon').hover( function(){
				$(this).stop(true,true).animate({ height: "+=4", width: "+=4", left: "-=2", top: "-=2" }, "fast");
				$(this).children('img.linkImage').stop(true,true).animate({ height: "+=4", width: "+=4" }, "fast");
			}, function() {
				$(this).stop(true,true).animate({ height: "-=4", width: "-=4", left: "+=2", top: "+=2" }, "fast");
				$(this).children('img.linkImage').stop(true,true).animate({ height: "-=4", width: "-=4" }, "fast");
			});

			// disable and enable mouseleave/enter stuffs on click
			$('.buttonIcon').click(function() {
				if ($(this).data('open') === 1) {
					$(this).parent().bind('mouseleave', hideLinks);
					$(this).parent().bind('mouseenter', showLinks);
					$(this).data('open', 0);
				} else {
					$(this).parent().unbind('mouseleave');
					$(this).parent().unbind('mouseenter');
					$(this).data('open', 1);
				}
			});


			// position buttons around center node
			var buttons = $('#main').children("div[id^='container_']").size();
			// find center of node circle...
			var node_x = $('#node').offset().left;
			var node_y = $('#node').offset().top;
			var button_index = 1;
			$("div[id^='container_']").each(function() {
				// variables used in positioning
				var button_angle = 2*Math.PI / buttons * button_index;
				var angleoffset = Math.PI/2;
				var pos_x = node_x + $(this).width()*Math.cos(button_angle + angleoffset);
				var pos_y = node_y + $(this).height()*Math.sin(button_angle + angleoffset);
				// rotate around the center of node...
				$(this).offset({"top": pos_y, "left": pos_x});
				// count child divs (links)
				var links = $(this).children('div.buttonLinks').children().size();
				var link_index = 1;
				// position each link around button
				$(this).children('div.buttonLinks').offset({"top": pos_y, "left": pos_x}).children().each(function() {
					var link_angle = 2*Math.PI / links * link_index;
					var link_pos_x = pos_x + ($(this).width()+27)*Math.cos(link_angle + angleoffset) + $(this).parent().parent().width()/2 - $(this).width()/2;
					var link_pos_y = pos_y + ($(this).height()+27)*Math.sin(link_angle + angleoffset) + $(this).parent().parent().width()/2 - $(this).width()/2;
					$(this).offset({"top": link_pos_y, "left": link_pos_x});
					link_index++;
				});
				button_index++;
			});

			// hide all buttonlinks divs after positioning is complete
			$('.buttonLinks').toggle();			

			// get local time from server
			nodeio.emit('get:time', function () {
				console.info('time data request');
				$('#data').append('*');
			});

			// popup dialog used for confirmations
			$("#confirm").dialog({
				autoOpen: false,
				modal: true,
				width: 600,
				height: 300,
				buttons: {
					"Ok": function() {
						$(this).dialog("close");
					},
					"Cancel": function() {
						$(this).dialog("close");
					}
				}
			});

			// popup dialog used for all content
			$("#popup").dialog({
				autoOpen: false,
				modal: true,
				resizable: false,
				width: 'auto',
				height: 'auto',
				dialogClass: "dlg-no-title",
				buttons: {
					"Save": function() {
						check();
						//$(this).dialog("close");
					},
					"Close": function() {
						$(this).dialog("close");
					}
				}
			});

			$(".linkIcon").on('click', function(e) {
				e.preventDefault();
				var href = '/popup/' + $(this).attr("id");
				$("#popup").html("");
				// show loady spinny thingy?
				$("#popup").load(href, function() {
					// hide load spinny thingy?
					$("#popup").dialog("open");
				});
			});

		});

		// functions

		function timeupdate(atime) {
			date = new Date(atime);
			year = date.getFullYear();
			month = date.getMonth();
			months = new Array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');
			d = date.getDate();
			day = date.getDay();
			days = new Array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday');
			h = date.getHours();
			if (h<10) h = "0"+h;
			m = date.getMinutes();
			if (m<10) m = "0"+m;
			s = date.getSeconds();
			if (s<10) s = "0"+s;

			$('#date').text(days[day] + ' ' + months[month] + ' ' + d + ' ' + year);
			$('#time').text(h + ':' + m + ':' + s);
		}

		// show and hide button links
		var hideLinks = function() {
			$(this).children('div.buttonLinks').fadeOut();
			$(this).children('div.buttonIcon').stop(true,true).animate({ height: "-=4", width: "-=4", left: "+=2", top: "+=2" }, "fast");
			$(this).children('div.buttonIcon').children('img.buttonImage').stop(true,true).animate({ height: "-=4", width: "-=4" }, "fast");
		}
		var showLinks = function() {
			$(this).children('div.buttonLinks').fadeIn();
			$(this).children('div.buttonIcon').stop(true,true).animate({ height: "+=4", width: "+=4", left: "-=2", top: "-=2" }, "fast");
			$(this).children('div.buttonIcon').children('img.buttonImage').stop(true,true).animate({ height: "+=4", width: "+=4" }, "fast");
		}
		// socket.io
		nodeio = io.connect();

		nodeio.on('time', function(timefromserver) {
			clearInterval(clock);
			serverTime = timefromserver;
			var clock = setInterval(function() {
				timeupdate(timefromserver);
				timefromserver += 1000;
			}, 1000);
			console.info('got time: ' + timefromserver);
		});

		nodeio.on('error', function (reason) {
			console.error('Unable to connect Socket.IO', reason);
		});

		nodeio.on('connect', function () {
			console.info('successfully established a working and authorized connection');
		});


block content
	div#node.center.dark.circle(style='width: 180px; height: 180px; position:relative; top:135px; z-index: 9;')
		h1.node #{hostname}
		h5#date.date &nbsp;
		h4#time.time &nbsp;

	div#container_settings.buttonContainer(style='position: absolute; width: 180px; height: 180px; border-radius: 999px; border: 3px solid transparent; z-index: 11;')
		div#button_settings.buttonIcon(title='Settings' style='position: absolute; width: 62px; height: 62px; top: 56px; left: 56px; color: #eaeaea; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #333; cursor: pointer;')
			img.buttonImage(src='/images/icons/settings.png' style='position: absolute; top: 7px; left: 7px;')

		div#settings_links.buttonLinks(style='position: absolute;')
			div#security.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #333; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;' title='Modify User Profile')
				img.linkImage(src='/images/security_small.png' style='position: absolute; top: 5px; left: 5px;')
			div#wifi.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;' title='Wireless Settings')
				img.linkImage(src='/images/wifi_small.png' style='position: absolute; top: 5px; left: 5px;')
			div#ethernet.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;' title='Ethernet Settings')
				img.linkImage(src='/images/network_small.png' style='position: absolute; top: 5px; left: 5px;')
			div#accesspoint.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;' title='Access Point Settings')
				img.linkImage(src='/images/router_small.png' style='position: absolute; top: 5px; left: 5px;')
			div#general.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;' title='Controller Settings')
				img.linkImage(src='/images/wrench_small.png' style='position: absolute; top: 5px; left: 5px;')

	div#container_control.buttonContainer(style='position: absolute; width: 180px; height: 180px; border-radius: 999px; border: 3px solid transparent; z-index: 7;')
		div#button_control.buttonIcon(title='Control' style='position: absolute; width: 62px; height: 62px; top: 56px; left: 56px; color: #eaeaea; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #333; cursor: pointer;')
			img.buttonImage(src='/images/icons/control.png' style='position: absolute; top: 7px; left: 7px;')
		div.buttonLinks(style='position: absolute;')

	div#container_schedule.buttonContainer(style='position: absolute; width: 180px; height: 180px; border-radius: 999px; border: 3px solid transparent; z-index: 7;')
		div#button_schedule.buttonIcon(title='Schedule' style='position: absolute; width: 62px; height: 62px; top: 56px; left: 56px; color: #eaeaea; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #333; cursor: pointer;')
			img.buttonImage(src='/images/icons/schedule.png' style='position: absolute; top: 7px; left: 7px;')
		div.buttonLinks(style='position: absolute;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #005000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/check.png' style='position: absolute; top: 5px; left: 5px;')

	div#container_sensor.buttonContainer(style='position: absolute; width: 180px; height: 180px; border-radius: 999px; border: 3px solid transparent; z-index: 7;')
		div#button_sensor.buttonIcon(title='Sensor' style='position: absolute; width: 62px; height: 62px; top: 56px; left: 56px; color: #eaeaea; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #333; cursor: pointer;')
			img.buttonImage(src='/images/icons/box.png' style='position: absolute; top: 7px; left: 7px;')
		div.buttonLinks(style='position: absolute;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')

	div#container_sensor.buttonContainer(style='position: absolute; width: 180px; height: 180px; border-radius: 999px; border: 3px solid transparent; z-index: 7;')
		div#button_sensor.buttonIcon(title='Sensor' style='position: absolute; width: 62px; height: 62px; top: 56px; left: 56px; color: #eaeaea; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #333; cursor: pointer;')
			img.buttonImage(src='/images/icons/box.png' style='position: absolute; top: 7px; left: 7px;')
		div.buttonLinks(style='position: absolute;')
	div#container_sensor.buttonContainer(style='position: absolute; width: 180px; height: 180px; border-radius: 999px; border: 3px solid transparent; z-index: 7;')
		div#button_sensor.buttonIcon(title='Sensor' style='position: absolute; width: 62px; height: 62px; top: 56px; left: 56px; color: #eaeaea; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #333; cursor: pointer;')
			img.buttonImage(src='/images/icons/box.png' style='position: absolute; top: 7px; left: 7px;')
		div.buttonLinks(style='position: absolute;')
	div#container_sensor.buttonContainer(style='position: absolute; width: 180px; height: 180px; border-radius: 999px; border: 3px solid transparent; z-index: 7;')
		div#button_sensor.buttonIcon(title='Sensor' style='position: absolute; width: 62px; height: 62px; top: 56px; left: 56px; color: #eaeaea; border: 1px solid #000; border-radius: 999px; background-color: #333; font-size: 2em; box-shadow: 0px 0px 6px #333; cursor: pointer;')
			img.buttonImage(src='/images/icons/box.png' style='position: absolute; top: 7px; left: 7px;')
		div.buttonLinks(style='position: absolute;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')
			div.linkIcon(style='position: absolute; width: 34px; height: 34px; color: #eee; border: 1px solid #000; border-radius: 999px; background-color: #a00000; font-size: 2em; box-shadow: 0px 0px 6px #555; cursor: pointer;')
				img.linkImage(src='/images/delete.png' style='position: absolute; top: 5px; left: 5px;')




	p(style='position: absolute; top: 450px;')#data
	div#popup
	div#confirm
